<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="net.ounwan.admin">
	<select id="checkAuthorization" parameterType="String" resultType="admin">
    	SELECT * FROM ADMIN WHERE ADMIN_ID = #{adminId}
    </select>
    
    <select id="selectTotalPriceByDate" resultType="map">
    	SELECT DATE_FORMAT(CURDATE(), '%m월 %d일') AS DATE, IFNULL(SUM(TOTAL_PRICE), 0) AS TOTAL_PRICE FROM ORDERS WHERE DATE_FORMAT(ORDER_DATE, '%Y-%m-%d') = CURDATE() UNION
		SELECT DATE_FORMAT(DATE_SUB(CURDATE(), INTERVAL 1 DAY), '%m월 %d일'), IFNULL(SUM(TOTAL_PRICE), 0) FROM ORDERS WHERE DATE_FORMAT(ORDER_DATE, '%Y-%m-%d') = DATE_SUB(CURDATE(), INTERVAL 1 DAY) UNION
		SELECT DATE_FORMAT(DATE_SUB(CURDATE(), INTERVAL 2 DAY), '%m월 %d일'), IFNULL(SUM(TOTAL_PRICE), 0) FROM ORDERS WHERE DATE_FORMAT(ORDER_DATE, '%Y-%m-%d') = DATE_SUB(CURDATE(), INTERVAL 2 DAY) UNION
		SELECT DATE_FORMAT(DATE_SUB(CURDATE(), INTERVAL 3 DAY), '%m월 %d일'), IFNULL(SUM(TOTAL_PRICE), 0) FROM ORDERS WHERE DATE_FORMAT(ORDER_DATE, '%Y-%m-%d') = DATE_SUB(CURDATE(), INTERVAL 3 DAY) UNION
		SELECT DATE_FORMAT(DATE_SUB(CURDATE(), INTERVAL 4 DAY), '%m월 %d일'), IFNULL(SUM(TOTAL_PRICE), 0) FROM ORDERS WHERE DATE_FORMAT(ORDER_DATE, '%Y-%m-%d') = DATE_SUB(CURDATE(), INTERVAL 4 DAY) UNION
		SELECT DATE_FORMAT(DATE_SUB(CURDATE(), INTERVAL 5 DAY), '%m월 %d일'), IFNULL(SUM(TOTAL_PRICE), 0) FROM ORDERS WHERE DATE_FORMAT(ORDER_DATE, '%Y-%m-%d') = DATE_SUB(CURDATE(), INTERVAL 5 DAY) UNION
		SELECT DATE_FORMAT(DATE_SUB(CURDATE(), INTERVAL 6 DAY), '%m월 %d일'), IFNULL(SUM(TOTAL_PRICE), 0) FROM ORDERS WHERE DATE_FORMAT(ORDER_DATE, '%Y-%m-%d') = DATE_SUB(CURDATE(), INTERVAL 6 DAY)
    </select>
    
    <select id="selectCommunityAct" resultType="map">
    	SELECT DATE_FORMAT(CURDATE(), '%m월 %d일') AS DATE, (SELECT IFNULL(COUNT(*), 0) FROM OUNWAN_COMMUNITY WHERE DATE_FORMAT(CREATED_DATE, '%Y-%m-%d') = CURDATE()) + (SELECT IFNULL(COUNT(*), 0) FROM AETA WHERE DATE_FORMAT(CREATED_DATE, '%Y-%m-%d') = CURDATE()) AS CNT UNION
		SELECT DATE_FORMAT(DATE_SUB(CURDATE(), INTERVAL 1 DAY), '%m월 %d일'), (SELECT IFNULL(COUNT(*), 0) FROM OUNWAN_COMMUNITY WHERE DATE_FORMAT(CREATED_DATE, '%Y-%m-%d') = DATE_SUB(CURDATE(), INTERVAL 1 DAY)) + (SELECT IFNULL(COUNT(*), 0) FROM AETA WHERE DATE_FORMAT(CREATED_DATE, '%Y-%m-%d') = DATE_SUB(CURDATE(), INTERVAL 1 DAY)) UNION
		SELECT DATE_FORMAT(DATE_SUB(CURDATE(), INTERVAL 2 DAY), '%m월 %d일'), (SELECT IFNULL(COUNT(*), 0) FROM OUNWAN_COMMUNITY WHERE DATE_FORMAT(CREATED_DATE, '%Y-%m-%d') = DATE_SUB(CURDATE(), INTERVAL 2 DAY)) + (SELECT IFNULL(COUNT(*), 0) FROM AETA WHERE DATE_FORMAT(CREATED_DATE, '%Y-%m-%d') = DATE_SUB(CURDATE(), INTERVAL 2 DAY)) UNION
		SELECT DATE_FORMAT(DATE_SUB(CURDATE(), INTERVAL 3 DAY), '%m월 %d일'), (SELECT IFNULL(COUNT(*), 0) FROM OUNWAN_COMMUNITY WHERE DATE_FORMAT(CREATED_DATE, '%Y-%m-%d') = DATE_SUB(CURDATE(), INTERVAL 3 DAY)) + (SELECT IFNULL(COUNT(*), 0) FROM AETA WHERE DATE_FORMAT(CREATED_DATE, '%Y-%m-%d') = DATE_SUB(CURDATE(), INTERVAL 3 DAY)) UNION
		SELECT DATE_FORMAT(DATE_SUB(CURDATE(), INTERVAL 4 DAY), '%m월 %d일'), (SELECT IFNULL(COUNT(*), 0) FROM OUNWAN_COMMUNITY WHERE DATE_FORMAT(CREATED_DATE, '%Y-%m-%d') = DATE_SUB(CURDATE(), INTERVAL 4 DAY)) + (SELECT IFNULL(COUNT(*), 0) FROM AETA WHERE DATE_FORMAT(CREATED_DATE, '%Y-%m-%d') = DATE_SUB(CURDATE(), INTERVAL 4 DAY)) UNION
		SELECT DATE_FORMAT(DATE_SUB(CURDATE(), INTERVAL 5 DAY), '%m월 %d일'), (SELECT IFNULL(COUNT(*), 0) FROM OUNWAN_COMMUNITY WHERE DATE_FORMAT(CREATED_DATE, '%Y-%m-%d') = DATE_SUB(CURDATE(), INTERVAL 5 DAY)) + (SELECT IFNULL(COUNT(*), 0) FROM AETA WHERE DATE_FORMAT(CREATED_DATE, '%Y-%m-%d') = DATE_SUB(CURDATE(), INTERVAL 5 DAY)) UNION
		SELECT DATE_FORMAT(DATE_SUB(CURDATE(), INTERVAL 6 DAY), '%m월 %d일'), (SELECT IFNULL(COUNT(*), 0) FROM OUNWAN_COMMUNITY WHERE DATE_FORMAT(CREATED_DATE, '%Y-%m-%d') = DATE_SUB(CURDATE(), INTERVAL 6 DAY)) + (SELECT IFNULL(COUNT(*), 0) FROM AETA WHERE DATE_FORMAT(CREATED_DATE, '%Y-%m-%d') = DATE_SUB(CURDATE(), INTERVAL 6 DAY))
    </select>
    
    <select id="selectTotalByCategory" resultType="map">
    	SELECT COUPUNG_CATEGORIES.NAME AS CATEGORY, IFNULL(SUM(ORDER_DETAILS.PRICE), 0) AS TOTAL_PRICE 
    	FROM ORDER_DETAILS LEFT JOIN COUPUNG ON ORDER_DETAILS.COUPUNG_NUMBER = COUPUNG.COUPUNG_NUMBER 
    	LEFT JOIN COUPUNG_CATEGORIES ON COUPUNG.COUPUNG_CATEGORY_NUMBER = COUPUNG_CATEGORIES.COUPUNG_CATEGORY_NUMBER GROUP BY COUPUNG_CATEGORIES.NAME
    </select>
</mapper>