<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="net.ounwan.danggun">
	<select id="selectAll" resultType="danggun">
		SELECT * FROM DANGGUN ORDER BY danggun_Number desc
	</select>

	<select id="searchProduct" parameterType="String" resultType="danggun">
		SELECT * FROM DANGGUN WHERE product_Name like CONCAT('%',#{name},'%') order by danggun_Number desc
	</select>
	
	<!-- PRODUCT_IMAGES1 테이블 이름 변경 필요 -->
	<select id="selectAllImage" parameterType="int" resultType="productImages">
		select * from PRODUCT_IMAGES1 where DANGGUN_NUMBER = #{danggunNumber} and TYPE=0;
	</select>
	
	<insert id="danggunInsert" parameterType="danggun">
		<selectKey keyColumn="DANGGUN_NUMBER" keyProperty="danggunNumber" order="AFTER" resultType="int">
			select DANGGUN_NUMBER from DANGGUN where 
			CLIENT_ID=#{clientId} order by DANGGUN_NUMBER desc limit 1
		</selectKey>
		insert into DANGGUN (`TRADE_HISTORY_NUMBER`, `CLIENT_ID`, `PRODUCT_NAME`,`PRICE`, `DETAIL`, `UPLOAD_DATE`) 
		VALUES (6, #{clientId}, #{productName}, #{price}, #{detail}, now())		
	</insert>
	
	<insert id="imageInsert" parameterType="map">
		insert into PRODUCT_IMAGES1 (`DANGGUN_NUMBER`, `URL`, `TYPE`)
		VALUES (#{danggunNumber}, #{url}, #{type})
	</insert>
</mapper>
